var P=Object.defineProperty;var M=(s,e,n)=>e in s?P(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var y=(s,e,n)=>M(s,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();class S{constructor(){y(this,"timeStep",30);y(this,"frozenTime",null);y(this,"timeOffset",0)}getCurrentTime(){return this.frozenTime!==null?this.frozenTime:Math.floor(Date.now()/1e3)+this.timeOffset}getCounter(){return Math.floor(this.getCurrentTime()/this.timeStep)}getTimeRemaining(){return this.timeStep-this.getCurrentTime()%this.timeStep}getTimeStep(){return this.timeStep}setTimeStep(e){this.timeStep=e}freezeTime(){this.frozenTime=this.getCurrentTime()}unfreezeTime(){this.frozenTime=null}isFrozen(){return this.frozenTime!==null}setTimeOffset(e){this.timeOffset=e}getTimeOffset(){return this.timeOffset}getState(){return{currentTime:this.getCurrentTime(),counter:this.getCounter(),timeStep:this.timeStep,timeRemaining:this.getTimeRemaining(),isFrozen:this.isFrozen()}}counterToBytes(){const e=this.getCounter(),n=new Uint8Array(8);let i=e;for(let t=7;t>=0;t--)n[t]=i&255,i=Math.floor(i/256);return n}}function v(s){return Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}const E="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";function I(s){const e=s.replace(/\s/g,"").toUpperCase().replace(/=+$/,""),n=[];let i=0,t=0;for(const o of e){const r=E.indexOf(o);if(r===-1)throw new Error(`Invalid Base32 character: ${o}`);t=t<<5|r,i+=5,i>=8&&(i-=8,n.push(t>>i&255))}return new Uint8Array(n)}function x(s){let e=0,n=0,i="";for(const t of s)for(n=n<<8|t,e+=8;e>=5;)e-=5,i+=E[n>>e&31];for(e>0&&(i+=E[n<<5-e&31]);i.length%8!==0;)i+="=";return i}function b(s=20){const e=new Uint8Array(s);return crypto.getRandomValues(e),e}async function H(s,e,n="SHA-1"){const i=new Uint8Array(s).buffer,t=new Uint8Array(e).buffer,o=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:n},!1,["sign"]),r=await crypto.subtle.sign("HMAC",o,t),c=new Uint8Array(r);return{hash:c,hashHex:v(c),algorithm:n}}function O(s,e){const n=s[s.length-1]&15,i=s.slice(n,n+4),t=(i[0]&255)<<24|(i[1]&255)<<16|(i[2]&255)<<8|i[3]&255,o=t&2147483647;return{offset:n,selectedBytes:i,selectedBytesHex:v(i),binaryValue:t,maskedValue:o}}async function L(s){const{secret:e,algorithm:n,digits:i,timeManager:t}=s,o=t.counterToBytes(),r=t.getCounter(),c=t.getCurrentTime(),l=await H(e,o,n),m=O(l.hash),d=Math.pow(10,i);return{otp:(m.maskedValue%d).toString().padStart(i,"0"),counter:r,counterBytes:o,counterBytesHex:v(o),hmacHash:l.hash,hmacHashHex:l.hashHex,truncation:m,algorithm:n,digits:i,timestamp:c}}class V{constructor(){y(this,"previousOTP","");y(this,"previousCounter",-1)}updateTimePanel(e,n,i,t,o){const r=document.getElementById("unix-timestamp"),c=document.getElementById("time-step-display"),l=document.getElementById("counter-value"),m=document.getElementById("time-remaining"),d=document.getElementById("formula-time"),u=document.getElementById("formula-step"),f=document.getElementById("formula-result"),g=document.querySelector("#countdown-ring"),T=document.getElementById("freeze-toggle");if(r&&(r.textContent=e.toString()),c&&(c.textContent=`${i}s`),l&&(n!==this.previousCounter&&(l.classList.add("animate"),setTimeout(()=>l.classList.remove("animate"),300)),l.textContent=n.toString()),m&&(m.textContent=t.toString()),d&&(d.textContent=e.toString()),u&&(u.textContent=i.toString()),f&&(f.textContent=n.toString()),g){const w=t/i*283;g.style.strokeDashoffset=(283-w).toString(),g.classList.remove("warning","danger"),t<=5?g.classList.add("danger"):t<=10&&g.classList.add("warning")}T&&(T.textContent=o?"▶️ Resume Time":"❄️ Freeze Time",T.classList.toggle("active",o)),this.previousCounter=n}updateSecretPanel(e,n){const i=document.getElementById("secret-base32"),t=document.getElementById("secret-hex-grid"),o=x(e),r=v(e);if(i&&(i.textContent=n==="base32"?o:r),t){t.innerHTML="";for(let c=0;c<e.length;c++){const l=document.createElement("div");l.className="byte-cell",l.textContent=e[c].toString(16).padStart(2,"0").toUpperCase(),t.appendChild(l)}}}updateHMACPanel(e,n){const i=document.getElementById("hmac-key-preview"),t=document.getElementById("hmac-counter-preview"),o=document.getElementById("hmac-algo-display"),r=document.getElementById("formula-algo"),c=document.getElementById("hash-length"),l=document.getElementById("hmac-hash-grid"),m=document.getElementById("hmac-animation-box");if(i){const u=v(n);i.textContent=u.length>20?u.substring(0,20)+"...":u}if(t){const u=Array.from(e.counterBytes).map(f=>f.toString(16).padStart(2,"0")).join(" ");t.textContent=u.toUpperCase()}const d=e.algorithm.replace("-","");if(o&&(o.textContent=d),r&&(r.textContent=d),c&&(c.textContent=e.hmacHash.length.toString()),m&&e.counter!==this.previousCounter&&(m.classList.add("processing"),setTimeout(()=>m.classList.remove("processing"),500)),l){l.innerHTML="";const u=e.truncation.offset;for(let f=0;f<e.hmacHash.length;f++){const g=document.createElement("div");g.className="byte-cell",f>=u&&f<u+4&&g.classList.add("selected"),f===e.hmacHash.length-1&&g.classList.add("offset"),g.textContent=e.hmacHash[f].toString(16).padStart(2,"0").toUpperCase(),g.title=`Byte ${f}`,l.appendChild(g)}}}updateTruncationPanel(e){const n=document.getElementById("last-byte-value"),i=document.getElementById("offset-value"),t=document.getElementById("selected-bytes-display"),o=document.getElementById("binary-value-display"),r=document.getElementById("masked-value-display"),c=e.hmacHash[e.hmacHash.length-1];if(n&&(n.textContent="0x"+c.toString(16).padStart(2,"0").toUpperCase()),i&&(i.textContent=e.truncation.offset.toString()),t){t.innerHTML="";for(let l=0;l<e.truncation.selectedBytes.length;l++){const m=document.createElement("div");m.className="byte-cell selected",m.textContent=e.truncation.selectedBytes[l].toString(16).padStart(2,"0").toUpperCase(),t.appendChild(m)}}o&&(o.textContent="0x"+e.truncation.binaryValue.toString(16).padStart(8,"0").toUpperCase()),r&&(r.textContent=e.truncation.maskedValue.toString())}updateOTPPanel(e,n){const i=document.getElementById("otp-previous"),t=document.getElementById("otp-current"),o=document.getElementById("otp-countdown"),r=document.getElementById("formula-masked"),c=document.getElementById("formula-digits"),l=document.getElementById("formula-otp");e.otp!==this.previousOTP&&(i&&this.previousOTP&&(i.textContent=this.previousOTP,i.classList.add("fade-in"),setTimeout(()=>i.classList.remove("fade-in"),300)),t&&(t.textContent=e.otp,t.classList.add("changing"),setTimeout(()=>t.classList.remove("changing"),500)),this.previousOTP=e.otp),o&&(o.textContent=n.toString()),r&&(r.textContent=e.truncation.maskedValue.toString()),c&&(c.textContent=e.digits.toString()),l&&(l.textContent=e.otp)}updateVerificationPanel(e,n){const i=document.getElementById("counter-checks"),t=document.getElementById("verification-result");i&&(i.innerHTML="",e.forEach((o,r)=>{const c=document.createElement("div");c.className="counter-check",o.matched?c.classList.add("matched"):n!==null&&c.classList.add("not-matched"),c.innerHTML=`
          <div class="counter-check-label">${o.current?"Current":r===0?"Previous":"Next"} (Counter: ${o.counter})</div>
          <div class="counter-check-otp">${o.otp}</div>
        `,setTimeout(()=>{c.classList.add("checking"),setTimeout(()=>c.classList.remove("checking"),500)},r*200),i.appendChild(c)})),t&&(n===null?(t.textContent="",t.className="verification-result"):n?(t.textContent="✅ OTP Verified Successfully!",t.className="verification-result success"):(t.textContent="❌ OTP Verification Failed",t.className="verification-result failure"))}clearVerification(){const e=document.getElementById("counter-checks"),n=document.getElementById("verification-result");e&&(e.innerHTML=""),n&&(n.textContent="",n.className="verification-result")}}const p=new V,a={secret:I("JBSWY3DPEHPK3PXP"),algorithm:"SHA-1",digits:6,secretViewMode:"base32",timeManager:new S,currentResult:null};let C=null;async function z(){k(),p.updateSecretPanel(a.secret,a.secretViewMode),await h(),A()}async function h(){const s=a.timeManager.getState();p.updateTimePanel(s.currentTime,s.counter,s.timeStep,s.timeRemaining,s.isFrozen);const e={secret:a.secret,algorithm:a.algorithm,digits:a.digits,timeManager:a.timeManager};try{const n=await L(e);a.currentResult=n,p.updateHMACPanel(n,a.secret),p.updateTruncationPanel(n),p.updateOTPPanel(n,s.timeRemaining)}catch(n){console.error("Error generating TOTP:",n)}}function A(){C&&clearInterval(C),C=window.setInterval(h,100)}function k(){const s=document.getElementById("time-step-select");s&&s.addEventListener("change",()=>{a.timeManager.setTimeStep(parseInt(s.value)),h()});const e=document.getElementById("time-offset"),n=document.getElementById("time-offset-value");e&&e.addEventListener("input",()=>{const u=parseInt(e.value);a.timeManager.setTimeOffset(u),n&&(n.textContent=`${u}s`),h()});const i=document.getElementById("freeze-toggle");i&&i.addEventListener("click",()=>{a.timeManager.isFrozen()?a.timeManager.unfreezeTime():a.timeManager.freezeTime(),h()});const t=document.getElementById("generate-secret");t&&t.addEventListener("click",()=>{a.secret=b(20);const u=document.getElementById("secret-input");u&&(u.value=x(a.secret)),p.updateSecretPanel(a.secret,a.secretViewMode),h()});const o=document.getElementById("secret-input");o&&o.addEventListener("change",()=>{try{a.secret=I(o.value),p.updateSecretPanel(a.secret,a.secretViewMode),h()}catch(u){console.error("Invalid Base32 secret:",u),alert("Invalid Base32 secret. Please enter a valid Base32 encoded string.")}});const r=document.getElementById("secret-view-mode");r&&r.addEventListener("change",()=>{a.secretViewMode=r.value,p.updateSecretPanel(a.secret,a.secretViewMode)});const c=document.getElementById("hash-algorithm");c&&c.addEventListener("change",()=>{a.algorithm=c.value,h()});const l=document.getElementById("otp-digits");l&&l.addEventListener("change",()=>{a.digits=parseInt(l.value),h()});const m=document.getElementById("verify-btn"),d=document.getElementById("verify-otp-input");m&&d&&(m.addEventListener("click",()=>B(d.value)),d.addEventListener("keypress",u=>{u.key==="Enter"&&B(d.value)}))}async function B(s){if(!s||s.length!==a.digits){alert(`Please enter a ${a.digits}-digit OTP`);return}const e=a.timeManager.getCounter(),n=[];let i=!1;for(let t=-1;t<=1;t++){const o=e+t,r=new S;r.setTimeStep(a.timeManager.getTimeStep());const c=o*a.timeManager.getTimeStep();r.setTimeOffset(c-Math.floor(Date.now()/1e3)),r.freezeTime();const l={secret:a.secret,algorithm:a.algorithm,digits:a.digits,timeManager:r},m=await L(l),d=m.otp===s;d&&(i=!0),n.push({counter:o,otp:m.otp,matched:d,current:t===0})}p.clearVerification(),setTimeout(()=>{p.updateVerificationPanel(n,null),setTimeout(()=>{p.updateVerificationPanel(n,i)},800)},100)}document.addEventListener("DOMContentLoaded",z);
